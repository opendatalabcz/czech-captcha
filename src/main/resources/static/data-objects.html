<!DOCTYPE html>
<html lang="en" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>CAPTCHA configuration</title>

    <script src="https://unpkg.com/vue@3.2.31"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js"></script>

    <script src="./js/object.js" type="module" defer></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
        <link rel="stylesheet" id="iconlib-link" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css">

    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<header class="page-header">
    <a href="site-configuration.html"><span class="header-option">Site configuration</span></a>
    <a href="data-objects.html"><span class="header-option selected">Data Objects</span></a>
    <a href="label-groups.html"><span class="header-option">Label Groups</span></a>
</header>
<main id="app">
    <section class="section">
        <div class="headline">Add object:</div>
        <form>
            <div class="my-form">
                <label for="source">Object source</label>
                <select name="source" id="source" v-model="source" required>
                    <option value="">Please select</option>
                    <option v-for="source in Object.keys(sources)" :value="source">{{ source }}</option>
                </select>
            </div>
            <div v-if="source === sources.URL" class="my-form">
                <label for="enteredUrl">URL</label>
<!--                <input type="url" id="enteredUrl" v-model="enteredUrl">-->
                <input type="url" id="enteredUrl" v-model="enteredUrl" v-on:change="handleChangeUrl()">
            </div>
            <div v-if="source === sources.File" class="my-form">
                <label for="objectFile">File</label>
                <input type="file" id="objectFile" accept="*/*" ref="objectFile" v-on:change="handleFileUpload()" multiple>
            </div>
            <div v-if="source === sources.Directory" class="my-form">
                <label for="objectDir">Directory</label>
                <input type="file" id="objectDir" accept="*/*" ref="objectDir" v-on:change="handleDirUpload()" webkitdirectory directory>
            </div>
            <div class="my-form">
                <label for="tag"><button v-on:click="addTag()" type="button">Add tag</button></label>
                <input id="tag" type="text" v-model="enteredTag">
                <label>Tags</label>
                <div class="array-pool">
                    <div v-for="(tag, index) in tags"><span>{{ tag }}</span> <button type="button" v-on:click="removeTag(index)" class="remove-icon fas fa-trash"></button></div>
                </div>
            </div>
            <div v-if="objectsToUpload.imagesCount > 0" class="my-form">
                <label for="labelGroup">Label group</label>
                <input id="labelGroup" type="text" v-model="enteredLabelGroup">
                <label for="label"><button v-on:click="addLabel()" type="button">Add label</button></label>
                <input id="label" type="text" v-model="enteredLabel">
                <label>Labels</label>
                <div v-for="(labels, labelGroup) in odWantedLabels" class="array-pool">
                    <div v-for="label in labels">
                        <span>{{ labelGroup }}->{{ label }}</span> <button type="button" v-on:click="removeLabel(labelGroup, label)" class="remove-icon fas fa-trash"></button>
                    </div>
                </div>

                <label for="odThreshold1">Object detection threshold 1</label>
                <input type="number" step="0.01" id="odThreshold1" v-model="odThreshold1"/>

                <label for="odThreshold2">Object detection threshold 2</label>
                <input type="number" step="0.01" id="odThreshold2" v-model="odThreshold2"/>
            </div>
            <button v-on:click="createObject()" type="button" class="important-button">Add object</button>
        </form>
    </section>
    <section class="section">
        <table class="styled-table">
            <tbody>
                <template v-for="obj in Object.values(objectsToUpload.toUpload)">
                    <tr>
                        <td v-if="obj.isUploading"><i class="fa-spinner fa-spin fas"></i></td>
                        <td v-if="obj.isUploading">Uploading</td>
                        <td>{{ obj.id }}</td>
                        <td>{{ obj.objectType }}</td>
                        <td>{{ obj.sourceType }}</td>
                        <td><button type="button" v-on:click="objectsToUpload.remove(obj.id)" class="remove-icon fas fa-trash"></button></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </section>
    <section class="last-section">
        <table class="styled-table">
            <thead>
            <tr>
                <th>Object Id</th>
                <th>Original name</th>
                <th>Type</th>
                <th>Owner</th>
                <th>Repository</th>
                <th>Path</th>
            </tr>
            </thead>
            <tbody>
                <template v-for="(object, index) in existingObjects">
                    <tr v-on:click="toggleRow(index)">
                        <td>{{ object.storageInfo.id }}</td>
                        <td>{{ object.storageInfo.originalName }}</td>
                        <td>{{ object.metadata.objectType.type }}</td>
                        <td>{{ object.storageInfo.owner }}</td>
                        <td>{{ object.storageInfo.repositoryType }}</td>
                        <td>{{ object.storageInfo.path }}</td>
                    </tr>
                    <tr v-if="isOpened(index)">
                        <td colspan="5" class="opened-row">
                            <div class="small-heading">Tags:</div>
                            <div class="object-content">{{ object.metadata.tags }}</div>
                            <div class="small-heading">Labels:</div>
                            <div class="object-content">{{ object.metadata.labels }}</div>
                            <div class="small-heading">Template data:</div>
                            <div class="object-content">{{ object.metadata.templateData }}</div>
                        </td>
                    </tr>
                </template>
            </tbody>
        </table>
    </section>
</main>
</body>
</html>
